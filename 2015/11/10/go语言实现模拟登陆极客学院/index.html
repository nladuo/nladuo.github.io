<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script src="http://tx.nladuo.cn:3000/analytics.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><title>go语言实现模拟登陆极客学院 · 叁公子的博客</title><meta name="description" content="go语言实现模拟登陆极客学院 - 叁公子KCN"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="../../../../avatar.jpg"><link rel="stylesheet" href="../../../../css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://nladuo.github.io/atom.xml" title="叁公子的博客"></head><body><div class="wrap"><header><a href="../../../../index.html" class="logo-link"><img src="../../../../avatar.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="../../../../index.html" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="../../../../archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nladuo" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">go语言实现模拟登陆极客学院</h1><div class="post-info">Nov 10, 2015</div><div class="post-content"><h2 id="&#x767B;&#x9646;&#x539F;&#x7406;"><a href="#&#x767B;&#x9646;&#x539F;&#x7406;" class="headerlink" title="&#x767B;&#x9646;&#x539F;&#x7406;"></a>&#x767B;&#x9646;&#x539F;&#x7406;</h2><p>&#x56E0;&#x4E3A;http&#x534F;&#x8BAE;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x3001;&#x77ED;&#x8FDE;&#x63A5;&#x7684;&#xFF0C;&#x5373;&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7ED9;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x670D;&#x52A1;&#x5668;&#x628A;&#x6570;&#x636E;&#x4F20;&#x56DE;&#x6765;&#xFF0C; &#x7136;&#x540E;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#x3002;  </p>
<p>&#x6240;&#x6709;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x673A;&#x5236;&#x6765;&#x4FDD;&#x8BC1;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x786E;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#xFF08;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x662F;&#x5426;&#x767B;&#x9646;&#xFF09;&#xFF0C;&#x8FD9;&#x4E2A;&#x673A;&#x5236;&#x5C31;&#x662F;session&#x548C;cookie&#xFF0C; &#x5176;&#x4E2D;session&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x4FDD;&#x5B58;&#x4F60;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;cookie&#x5219;&#x662F;&#x4FDD;&#x5B58;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x91CC;&#x9762;&#x3002;  </p>
<p>&#x90A3;&#x4E48;&#x767B;&#x9646;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x8FC7;&#x7A0B;&#xFF1F;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6BD4;&#x5982;&#x8BF4;&#xFF0C;&#x5148;&#x8F93;&#x5165;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;&#xFF0C;&#x628A;&#x6570;&#x636E;post&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x5BF9;&#x586B;&#x5199;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C; &#x5982;&#x679C;&#x6821;&#x9A8C;&#x901A;&#x8FC7;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x6BB5;session&#x4FE1;&#x606F;&#xFF0C;&#x8FD4;&#x56DE;&#x7ED9;&#x4F60;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x4F60;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x628A;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x6765;&#x7684;session&#x4FDD;&#x5B58;&#x5728;&#x672C;&#x5730;&#xFF0C; &#x5230;&#x4E86;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#xFF0C;&#x4E5F;&#x5C31;&#x53D8;&#x6210;cookie&#x4E86;&#x3002;&#x6BD4;&#x5982;&#x8BF4;&#x767B;&#x9646;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x6210;&#x529F;&#x4E86;&#xFF0C; &#x670D;&#x52A1;&#x5668;&#x5728;&#x5BF9;&#x5E94;&#x7528;&#x6237;&#x5BF9;&#x5E94;&#x7684;session&#x91CC;&#x9762;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;is_login=true&#x7684;&#x5B57;&#x6BB5;&#x3002; &#x6D4F;&#x89C8;&#x5668;&#x5728;&#x4E0B;&#x6B21;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x57DF;&#x540D;&#x7684;&#x7F51;&#x7AD9;&#x4E0B;&#x7684;&#x5176;&#x4ED6;&#x9875;&#x9762;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x628A;&#x5B58;&#x7684;cookie&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x3002;  </p>
<a id="more"></a>
<h2 id="&#x5982;&#x4F55;&#x6A21;&#x62DF;&#x767B;&#x9646;&#x5E26;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x7F51;&#x7AD9;"><a href="#&#x5982;&#x4F55;&#x6A21;&#x62DF;&#x767B;&#x9646;&#x5E26;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x7F51;&#x7AD9;" class="headerlink" title="&#x5982;&#x4F55;&#x6A21;&#x62DF;&#x767B;&#x9646;&#x5E26;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x7F51;&#x7AD9;"></a>&#x5982;&#x4F55;&#x6A21;&#x62DF;&#x767B;&#x9646;&#x5E26;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x7F51;&#x7AD9;</h2><p>&#x5176;&#x5B9E;&#x5728;&#x6253;&#x5F00;&#x5E26;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x9875;&#x9762;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x6709;&#x4E00;&#x6B21;&#x201C;&#x767B;&#x9646;&#x201D;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x4E2A;&#x767B;&#x9646;&#x4E0D;&#x662F;&#x4E3A;&#x6211;&#x4EEC;&#x7684;cookie&#x6DFB;&#x52A0; &#x4E00;&#x4E2A;is_login&#x5B57;&#x6BB5;&#xFF0C;&#x800C;&#x662F;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;verify-code&#x6216;&#x8005;&#x53EB;captcha&#x5B57;&#x6BB5;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x628A;&#x9A8C;&#x8BC1;&#x7801;&#x5B58;&#x5728;&#x91CC;&#x9762;&#xFF0C;&#x8FD9;&#x6837;&#x5B83; &#x624D;&#x77E5;&#x9053;&#x5B83;&#x751F;&#x6210;&#x7684;&#x6BCF;&#x4E2A;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x90A3;&#x4E2A;&#x7528;&#x6237;&#x751F;&#x6210;&#x7684;&#x3002;  </p>
<p>&#x6240;&#x4EE5;&#x6A21;&#x62DF;&#x767B;&#x9646;&#x5F85;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x7F51;&#x7AD9;&#x9700;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>1&#x3001;&#x8BBF;&#x95EE;&#x9700;&#x8981;&#x767B;&#x9646;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x5E76;&#x83B7;&#x53D6;cookie</li>
<li>2&#x3001;&#x5E26;&#x7740;cookie&#xFF0C;&#x4E0B;&#x8F7D;&#x9A8C;&#x8BC1;&#x7801;&#x56FE;&#x7247;</li>
<li>3&#x3001;&#x5E26;&#x7740;cookie&#xFF0C;&#x628A;&#x7528;&#x6237;&#x6570;&#x636E;&#xFF08;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5BC6;&#x7801;&#xFF0C;&#x9A8C;&#x8BC1;&#x7801;&#xFF09;&#x901A;&#x8FC7;post&#x65B9;&#x5F0F;&#x53D1;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x62FF;&#x5230;cookie&#x3002;<br>&#x7ECF;&#x8FC7;&#x4EE5;&#x4E0A;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x62FF;&#x5230;&#x767B;&#x9646;&#x7684;cookie&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x5E26;&#x7740;&#x8FD9;&#x4E2A;cookie&#x53BB;&#x8BBF;&#x95EE;&#x9700;&#x8981;&#x6743;&#x9650;&#x7684;&#x9875;&#x9762;&#x3002; &#x4EE5;&#x4E0B;&#x662F;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#xFF0C;go&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x3002;(&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4F1A;&#x9996;&#x5148;&#x6A21;&#x62DF;&#x767B;&#x9646;&#x6781;&#x5BA2;&#x5B66;&#x9662;&#xFF0C;&#x7136;&#x540E;&#x722C;&#x53D6;&#x804C;&#x4E1A;&#x8DEF;&#x5F84;&#x4E2D;docker&#x7684;&#x89C6;&#x9891;&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;&#xFF0C; &#x7136;&#x540E;&#x751F;&#x6210;&#x4E00;&#x5806;wget&#x7EC4;&#x6210;&#x7684;shell&#x811A;&#x672C;&#xFF0C;&#x8FD0;&#x884C;&#x811A;&#x672C;&#x5C31;&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x89C6;&#x9891;&#xFF0C;&#x4E0D;&#x8FC7;&#x4EC5;&#x5BF9;&#x8BFE;&#x7A0B;&#x5C11;&#x7684;&#x89C6;&#x9891;&#x7BA1;&#x7528;&#xFF0C; &#x6781;&#x5BA2;&#x7684;&#x89C6;&#x9891;&#x64AD;&#x653E;&#x7684;&#x5730;&#x5740;&#x4F1A;&#x65F6;&#x65F6;&#x523B;&#x523B;&#x53D8;&#x66F4;)</li>
</ul>
<h2 id="&#x4EE3;&#x7801;"><a href="#&#x4EE3;&#x7801;" class="headerlink" title="&#x4EE3;&#x7801;"></a>&#x4EE3;&#x7801;</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">&quot;fmt&quot;</span></div><div class="line">	<span class="string">&quot;github.com/PuerkitoBio/goquery&quot;</span></div><div class="line">	<span class="string">&quot;io&quot;</span></div><div class="line">	<span class="string">&quot;io/ioutil&quot;</span></div><div class="line">	<span class="string">&quot;net/http&quot;</span></div><div class="line">	<span class="string">&quot;net/http/cookiejar&quot;</span></div><div class="line">	<span class="string">&quot;net/url&quot;</span></div><div class="line">	<span class="string">&quot;os&quot;</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">var</span> cookies []*http.Cookie</div><div class="line"></div><div class="line"><span class="keyword">const</span> (</div><div class="line">	spider_base_url     <span class="keyword">string</span> = <span class="string">&quot;http://www.jikexueyuan.com/path/docker/&quot;</span></div><div class="line">	login_url           <span class="keyword">string</span> = <span class="string">&quot;http://passport.jikexueyuan.com/sso/login&quot;</span></div><div class="line">	verify_code_url     <span class="keyword">string</span> = <span class="string">&quot;http://passport.jikexueyuan.com/sso/verify&quot;</span></div><div class="line">	post_login_info_url <span class="keyword">string</span> = <span class="string">&quot;http://passport.jikexueyuan.com/submit/login?is_ajax=1&quot;</span></div><div class="line">	username            <span class="keyword">string</span> = <span class="string">&quot;&#x7528;&#x6237;&#x540D;&quot;</span></div><div class="line">	password            <span class="keyword">string</span> = <span class="string">&quot;&#x5BC6;&#x7801;&quot;</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">getResultHtml</span><span class="params">(get_url <span class="keyword">string</span>)</span> *<span class="title">http</span>.<span class="title">Response</span></span> {</div><div class="line">	c := &amp;http.Client{}</div><div class="line">	Jar, _ := cookiejar.New(<span class="literal">nil</span>)</div><div class="line">	getURL, _ := url.Parse(get_url)</div><div class="line">	Jar.SetCookies(getURL, cookies)</div><div class="line">	c.Jar = Jar</div><div class="line">	res, _ := c.Get(get_url)</div><div class="line">	<span class="keyword">return</span> res</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">()</span></span> {</div><div class="line">	<span class="comment">//&#x83B7;&#x53D6;&#x767B;&#x9646;&#x754C;&#x9762;&#x7684;cookie</span></div><div class="line">	c := &amp;http.Client{}</div><div class="line">	req, _ := http.NewRequest(<span class="string">&quot;GET&quot;</span>, login_url, <span class="literal">nil</span>)</div><div class="line">	res, _ := c.Do(req)</div><div class="line"></div><div class="line">	req.URL, _ = url.Parse(verify_code_url)</div><div class="line">	<span class="keyword">var</span> temp_cookies = res.Cookies()</div><div class="line"></div><div class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> res.Cookies() {</div><div class="line">		req.AddCookie(v)</div><div class="line">	}</div><div class="line">	<span class="comment">// &#x83B7;&#x53D6;&#x9A8C;&#x8BC1;&#x7801;</span></div><div class="line">	<span class="keyword">var</span> verify_code <span class="keyword">string</span></div><div class="line">	<span class="keyword">for</span> {</div><div class="line">		res, _ = c.Do(req)</div><div class="line">		file, _ := os.Create(<span class="string">&quot;verify.gif&quot;</span>)</div><div class="line">		io.Copy(file, res.Body)</div><div class="line">        <span class="comment">//&#x6700;&#x5F00;&#x59CB;&#x6D4B;&#x8BD5;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x73B0;&#x5728;&#x597D;&#x50CF;&#x6539;&#x4E86;&#xFF0C;</span></div><div class="line">        <span class="comment">//&#x6700;&#x597D;&#x4E00;&#x6B21;&#x8F93;&#x5165;&#x6B63;&#x786E;&#xFF0C;&#x7136;&#x540E;10&#x79D2;&#x4EE5;&#x5185;&#x8F93;&#x5165;&#xFF0C;</span></div><div class="line">        <span class="comment">//&#x5426;&#x5219;&#xFF0C;&#x4F1A;&#x62A5;&#x51FA;connection reset by peer</span></div><div class="line">		fmt.Println(<span class="string">&quot;&#x8BF7;&#x67E5;&#x770B;verify.gif&#xFF0C; &#x7136;&#x540E;&#x8F93;&#x5165;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C; &#x770B;&#x4E0D;&#x6E05;&#x8F93;&#x5165;0&#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x9A8C;&#x8BC1;&#x7801;&quot;</span>)</div><div class="line">		fmt.Scanf(<span class="string">&quot;%s&quot;</span>, &amp;verify_code)</div><div class="line">		<span class="keyword">if</span> verify_code != <span class="string">&quot;0&quot;</span> {</div><div class="line">			<span class="keyword">break</span></div><div class="line">		}</div><div class="line">		res.Body.Close()</div><div class="line">	}</div><div class="line">	<span class="comment">//post&#x6570;&#x636E;</span></div><div class="line">	postValues := url.Values{}</div><div class="line">	postValues.Add(<span class="string">&quot;expire&quot;</span>, <span class="string">&quot;7&quot;</span>)</div><div class="line">	postValues.Add(<span class="string">&quot;referer&quot;</span>, <span class="string">&quot;http%3A%2F%2Fwww.jikexueyuan.com%2F&quot;</span>)</div><div class="line">	postValues.Add(<span class="string">&quot;uname&quot;</span>, username)</div><div class="line">	postValues.Add(<span class="string">&quot;password&quot;</span>, password)</div><div class="line">	postValues.Add(<span class="string">&quot;verify&quot;</span>, verify_code)</div><div class="line"></div><div class="line">	postURL, _ := url.Parse(post_login_info_url)</div><div class="line">	Jar, _ := cookiejar.New(<span class="literal">nil</span>)</div><div class="line">	Jar.SetCookies(postURL, temp_cookies)</div><div class="line">	c.Jar = Jar</div><div class="line">	res, _ = c.PostForm(post_login_info_url,</div><div class="line">		postValues)</div><div class="line"></div><div class="line">	cookies = res.Cookies()</div><div class="line">	data, _ := ioutil.ReadAll(res.Body)</div><div class="line">	res.Body.Close()</div><div class="line">	fmt.Println(<span class="keyword">string</span>(data))</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">type</span> DownloadBean <span class="keyword">struct</span> {</div><div class="line">	dirname  <span class="keyword">string</span></div><div class="line">	filename <span class="keyword">string</span></div><div class="line">	href     <span class="keyword">string</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</div><div class="line"></div><div class="line">	login()</div><div class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> cookies {</div><div class="line">		fmt.Println(v)</div><div class="line">	}</div><div class="line">	<span class="keyword">var</span> bash_str <span class="keyword">string</span> = <span class="string">&quot;#!/bin/bash \n&quot;</span></div><div class="line">	baseMap := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{}</div><div class="line">	doc, _ := goquery.NewDocumentFromResponse(getResultHtml(spider_base_url))</div><div class="line">	doc.Find(<span class="string">&quot;.lesson-info-h2&quot;</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, contentSelection *goquery.Selection)</span></span> {</div><div class="line">		selection := contentSelection.Find(<span class="string">&quot;a&quot;</span>)</div><div class="line">		base_href, _ := selection.Attr(<span class="string">&quot;href&quot;</span>)</div><div class="line">		dir_name := selection.Text()</div><div class="line">		bash_str += <span class="string">&quot;mkdir \&quot;&quot;</span> + dir_name + <span class="string">&quot;\&quot;\n&quot;</span></div><div class="line">		baseMap[dir_name] = base_href</div><div class="line">		fmt.Println(dir_name, <span class="string">&quot;--&gt;&quot;</span>, base_href)</div><div class="line"></div><div class="line">	})</div><div class="line">	downloadList := []DownloadBean{}</div><div class="line"></div><div class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> baseMap {</div><div class="line">		doc, _ := goquery.NewDocumentFromResponse(getResultHtml(v))</div><div class="line">		doc.Find(<span class="string">&quot;.lessonvideo-list dd h2&quot;</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, contentSelection *goquery.Selection)</span></span> {</div><div class="line">			selection := contentSelection.Find(<span class="string">&quot;a&quot;</span>)</div><div class="line">			href, _ := selection.Attr(<span class="string">&quot;href&quot;</span>)</div><div class="line">			filename := selection.Text()</div><div class="line">			fmt.Println(k, <span class="string">&quot;--&gt;&quot;</span>, filename, <span class="string">&quot;--&gt;&quot;</span>, href)</div><div class="line">			bean := DownloadBean{dirname: k, href: href, filename: filename}</div><div class="line">			downloadList = <span class="built_in">append</span>(downloadList, bean)</div><div class="line">		})</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> downloadList {</div><div class="line">		doc, _ := goquery.NewDocumentFromResponse(getResultHtml(v.href))</div><div class="line">		doc.Find(<span class="string">&quot;source&quot;</span>).Each(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, contentSelection *goquery.Selection)</span></span> {</div><div class="line">			download_url, _ := contentSelection.Attr(<span class="string">&quot;src&quot;</span>)</div><div class="line">			one_file := <span class="string">&quot;wget &quot;</span> + download_url + <span class="string">&quot;  -O \&quot;./&quot;</span> + v.dirname + <span class="string">&quot;/&quot;</span> + v.filename + <span class="string">&quot;.mp4\&quot;\n&quot;</span></div><div class="line">			bash_str += one_file</div><div class="line">			fmt.Println(one_file)</div><div class="line">		})</div><div class="line">	}</div><div class="line"></div><div class="line">	err := ioutil.WriteFile(<span class="string">&quot;./download.sh&quot;</span>, []<span class="keyword">byte</span>(bash_str), <span class="number">0x777</span>)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</div><div class="line">		<span class="built_in">panic</span>(err.Error())</div><div class="line">	}</div><div class="line"></div><div class="line">	fmt.Println(<span class="string">&quot;&#x5199;&#x5165;&#x811A;&#x672C;&#x5B8C;&#x6210;&quot;</span>)</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x8BF4;&#x660E;"><a href="#&#x8BF4;&#x660E;" class="headerlink" title="&#x8BF4;&#x660E;"></a>&#x8BF4;&#x660E;</h2><p>&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x4E0D;&#x9075;&#x5FAA;robots&#x534F;&#x8BAE;&#xFF0C;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;&#x3002;</p>
</div></article></div></main><footer><div class="paginator"><a href="../../../12/09/教你DIY一个PM2.5检测仪/" class="prev">上一篇</a><a href="../../../05/03/用csharp编写8x8横向取模软件/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2015/11/10/go语言实现模拟登陆极客学院/';
var disqus_title = 'go语言实现模拟登陆极客学院';
var disqus_url = 'http://nladuo.github.io/2015/11/10/go语言实现模拟登陆极客学院/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2020 <a href="http://nladuo.github.io">叁公子KCN</a>, <a href="http://www.beian.miit.gov.cn/">京ICP备17062395号</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>