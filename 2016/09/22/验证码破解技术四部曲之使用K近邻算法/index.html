<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script src="http://tx.kalen.site:3000/analytics.js"></script><title>验证码破解技术四部曲之使用K近邻算法（三） · 叁公子的博客</title><meta name="description" content="验证码破解技术四部曲之使用K近邻算法（三） - 叁公子"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="../../../../avatar.jpg"><link rel="stylesheet" href="../../../../css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://nladuo.github.io/atom.xml" title="叁公子的博客"></head><body><div class="wrap"><header><a href="../../../../index.html" class="logo-link"><img src="../../../../avatar.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="../../../../index.html" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="../../../../archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nladuo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://nladuo.github.io/resume" target="_blank" class="nav-list-link">RESUME</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">验证码破解技术四部曲之使用K近邻算法（三）</h1><div class="post-info">Sep 22, 2016</div><div class="post-content"><h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x5728;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;google&#x7684;&#x5F00;&#x6E90;OCR&#x5E93;&#x6765;&#x5BF9;&#x5B57;&#x7B26;&#x8FDB;&#x884C;&#x8BC6;&#x522B;&#xFF0C;&#x8FD9;&#x4E00;&#x8282;&#x4EE5;&#x53CA;&#x4E0B;&#x4E00;&#x8282;&#x6211;&#x4EEC;&#x5C06;&#x8981;&#x4F7F;&#x7528;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x6765;&#x8BC6;&#x522B;&#x9A8C;&#x8BC1;&#x7801;&#x3002;&#x672C;&#x8282;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x5728;<a href="https://github.com/nladuo/captcha-break/tree/master/csdn" target="_blank" rel="external">https://github.com/nladuo/captcha-break/tree/master/csdn</a>&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x3002;</p>
<h2 id="&#x4E0B;&#x8F7D;&#x9A8C;&#x8BC1;&#x7801;"><a href="#&#x4E0B;&#x8F7D;&#x9A8C;&#x8BC1;&#x7801;" class="headerlink" title="&#x4E0B;&#x8F7D;&#x9A8C;&#x8BC1;&#x7801;"></a>&#x4E0B;&#x8F7D;&#x9A8C;&#x8BC1;&#x7801;</h2><p>&#x5728;&#x8FD9;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x5C06;&#x8981;&#x5BF9;CSDN&#x4E0B;&#x8F7D;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#x8FDB;&#x884C;&#x7834;&#x89E3;&#xFF0C;&#x5C31;&#x662F;&#x5728;<a href="http://download.csdn.net/" target="_blank" rel="external">http://download.csdn.net/</a>&#x4E0B;&#x8F7D;&#x4E1C;&#x897F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x4E0B;&#x8F7D;&#x6B21;&#x6570;&#x8FC7;&#x591A;&#x5F39;&#x51FA;&#x6765;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#x3002;<br><br></p>
<a id="more"></a>
<p>&#x505A;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x5C31;&#x662F;&#x91C7;&#x96C6;&#x6570;&#x636E;&#xFF0C;&#x6784;&#x5EFA;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x6765;&#x770B;&#x4E00;&#x4E0B;CSDN&#x4E0B;&#x8F7D;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#x3002;<br><br><img src="/2016/09/22/&#x9A8C;&#x8BC1;&#x7801;&#x7834;&#x89E3;&#x6280;&#x672F;&#x56DB;&#x90E8;&#x66F2;&#x4E4B;&#x4F7F;&#x7528;K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;/captcha1.png" alt="captcha1">  <img src="/2016/09/22/&#x9A8C;&#x8BC1;&#x7801;&#x7834;&#x89E3;&#x6280;&#x672F;&#x56DB;&#x90E8;&#x66F2;&#x4E4B;&#x4F7F;&#x7528;K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;/captcha2.png" alt="captcha2"><br><br></p>
<p>&#x5728;&#x6BCF;&#x6B21;&#x5237;&#x65B0;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x6709;&#x4EE5;&#x4E0A;&#x8FD9;&#x4E24;&#x79CD;&#x9A8C;&#x8BC1;&#x7801;&#x51FA;&#x73B0;&#x3002;&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x5B66;&#x4E60;K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#xFF08;&#x7B80;&#x79F0;&#x4E3A;&#xFF1A;KNN&#xFF09;&#xFF0C;&#x9009;&#x62E9;&#x7B2C;&#x4E8C;&#x79CD;&#x6765;&#x8FDB;&#x884C;&#x7834;&#x89E3;&#xFF0C;&#x56E0;&#x4E3A;&#x7B2C;&#x4E8C;&#x79CD;&#x7684;&#x5B57;&#x6BCD;&#x5206;&#x5272;&#x5341;&#x5206;&#x5BB9;&#x6613;&#xFF0C;&#x6BCF;&#x4E2A;&#x5B57;&#x6BCD;&#x7684;&#x4F4D;&#x7F6E;&#x90FD;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#x3002;<br><br></p>
<p>&#x7531;&#x4E8E;&#x4E24;&#x79CD;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x56FE;&#x7247;&#x5927;&#x5C0F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x56FE;&#x7247;&#x5927;&#x5C0F;&#x6765;&#x5224;&#x65AD;&#x54EA;&#x4E2A;&#x662F;&#x7B2C;&#x4E00;&#x79CD;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C;&#x54EA;&#x4E2A;&#x662F;&#x7B2C;&#x4E8C;&#x79CD;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;python&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#x7801;&#x4E0B;&#x8F7D;&#x3002;<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf-8</span></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> uuid</div><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line">url = <span class="string">&quot;http://download.csdn.net/index.php/rest/tools/validcode/source_ip_validate/10.5711163911089325&quot;</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</div><div class="line">    resp = requests.get(url)</div><div class="line">    filename = <span class="string">&quot;./captchas/&quot;</span> + str(uuid.uuid4()) + <span class="string">&quot;.png&quot;</span></div><div class="line">    <span class="keyword">with</span> open(filename, <span class="string">&apos;wb&apos;</span>) <span class="keyword">as</span> f:</div><div class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> resp.iter_content(chunk_size=<span class="number">1024</span>):</div><div class="line">            <span class="keyword">if</span> chunk:  <span class="comment"># filter out keep-alive new chunks</span></div><div class="line">                f.write(chunk)</div><div class="line">                f.flush()</div><div class="line">        f.close()</div><div class="line">    im = Image.open(filename)</div><div class="line">    <span class="keyword">if</span> im.size != (<span class="number">48</span>, <span class="number">20</span>):</div><div class="line">        os.remove(filename)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> filename</div></pre></td></tr></table></figure></p>
<h2 id="&#x5206;&#x5272;&#x5B57;&#x7B26;"><a href="#&#x5206;&#x5272;&#x5B57;&#x7B26;" class="headerlink" title="&#x5206;&#x5272;&#x5B57;&#x7B26;"></a>&#x5206;&#x5272;&#x5B57;&#x7B26;</h2><p>&#x4E0B;&#x8F7D;&#x8FC7;&#x540E;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5BF9;&#x5B57;&#x6BCD;&#x8FDB;&#x884C;&#x5206;&#x5272;&#x3002;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x867D;&#x7136;&#x725B;&#x903C;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x9700;&#x8981;&#x5BF9;&#x6837;&#x672C;&#x8FDB;&#x884C;&#x9884;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x9884;&#x5904;&#x7406;&#x5C31;&#x662F;&#x628A;&#x5B57;&#x6BCD;&#x5206;&#x5272;&#x51FA;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x5206;&#x5272;&#x6210;&#x540C;&#x6837;&#x7684;&#x5C3A;&#x5BF8;&#x3002;&#x5206;&#x5272;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE3;&#x7801;&#x5206;&#x5272;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EBA;&#x7528;PS&#x7B49;&#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x624B;&#x52A8;&#x5206;&#x5272;&#x3002;<br></p>
<p>&#x6211;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4EE3;&#x7801;&#x5206;&#x5272;&#xFF0C;&#x5B57;&#x6BCD;&#x5206;&#x5272;&#x7684;&#x4EE3;&#x7801;&#x5728;spliter&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x6211;&#x4F7F;&#x7528;&#x4E86;boost&#x5E93;&#x6765;&#x6765;&#x8BFB;&#x53D6;&#x6240;&#x6709;&#x4E0B;&#x8F7D;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x4E8C;&#x503C;&#x5316;&#x540E;&#xFF0C;&#x8FDB;&#x884C;&#x5B9A;&#x70B9;&#x5206;&#x5272;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5206;&#x5272;&#x597D;&#x7684;&#x5B57;&#x6BCD;&#x5982;&#x4E0B;&#x3002;<br><br><img src="/2016/09/22/&#x9A8C;&#x8BC1;&#x7801;&#x7834;&#x89E3;&#x6280;&#x672F;&#x56DB;&#x90E8;&#x66F2;&#x4E4B;&#x4F7F;&#x7528;K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;/letters.png" alt="letters"><br><br></p>
<p>&#x4E4B;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x4EBA;&#x5DE5;&#x5BF9;&#x5B57;&#x6BCD;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#xFF0C;&#x5206;&#x7C7B;&#x597D;&#x7684;&#x56FE;&#x7247;&#x89C1;recognizer/dataset&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x6BCF;&#x4E2A;&#x5B57;&#x6BCD;&#x9700;&#x8981;6&#x4E2A;&#x6837;&#x672C;&#xFF0C;10&#x4E2A;&#x5B57;&#x6BCD;&#xFF0C;&#x603B;&#x5171;60&#x4E2A;&#x6837;&#x672C;&#x3002;<br><br><img src="/2016/09/22/&#x9A8C;&#x8BC1;&#x7801;&#x7834;&#x89E3;&#x6280;&#x672F;&#x56DB;&#x90E8;&#x66F2;&#x4E4B;&#x4F7F;&#x7528;K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;/dataset.png" alt="dataset"><br><br></p>
<h2 id="&#x7B97;&#x6CD5;&#x539F;&#x7406;"><a href="#&#x7B97;&#x6CD5;&#x539F;&#x7406;" class="headerlink" title="&#x7B97;&#x6CD5;&#x539F;&#x7406;"></a>&#x7B97;&#x6CD5;&#x539F;&#x7406;</h2><p>K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;&#x7684;&#x5B9A;&#x4E49;&#x5341;&#x5206;&#x7B80;&#x5355;&#xFF0C;&#x5728;&#x767E;&#x5EA6;&#x767E;&#x79D1;&#x4E0A;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x89E3;&#x91CA;&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6837;&#x672C;&#x5728;&#x7279;&#x5F81;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;k&#x4E2A;&#x6700;&#x76F8;&#x4F3C;(&#x5373;&#x7279;&#x5F81;&#x7A7A;&#x95F4;&#x4E2D;&#x6700;&#x90BB;&#x8FD1;)&#x7684;&#x6837;&#x672C;&#x4E2D;&#x7684;&#x5927;&#x591A;&#x6570;&#x5C5E;&#x4E8E;&#x67D0;&#x4E00;&#x4E2A;&#x7C7B;&#x522B;&#xFF0C;&#x5219;&#x8BE5;&#x6837;&#x672C;&#x4E5F;&#x5C5E;&#x4E8E;&#x8FD9;&#x4E2A;&#x7C7B;&#x522B;&#x3002;<br><br></p>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x9700;&#x8981;&#x627E;&#x5230;&#x8981;&#x8BC6;&#x522B;&#x7684;&#x5B57;&#x6BCD;&#x5728;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#x4E2D;K&#x4E2A;&#x6700;&#x8FD1;&#x7684;&#x5B57;&#x6BCD;&#xFF0C;&#x7136;&#x540E;&#x627E;&#x51FA;&#x8FD9;K&#x4E2A;&#x5B57;&#x6BCD;&#x4E2D;&#x6700;&#x591A;&#x7684;&#x662F;&#x67D0;&#x4E2A;&#x7C7B;&#x7684;&#xFF1F;&#x8981;&#x8BC6;&#x522B;&#x7684;&#x56FE;&#x7247;&#x4E5F;&#x5C31;&#x662F;&#x8BE5;&#x7C7B;&#x7684;&#x3002;</p>
<h2 id="&#x5B9E;&#x73B0;KNN"><a href="#&#x5B9E;&#x73B0;KNN" class="headerlink" title="&#x5B9E;&#x73B0;KNN"></a>&#x5B9E;&#x73B0;KNN</h2><h4 id="&#x8BA1;&#x7B97;&#x8DDD;&#x79BB;"><a href="#&#x8BA1;&#x7B97;&#x8DDD;&#x79BB;" class="headerlink" title="&#x8BA1;&#x7B97;&#x8DDD;&#x79BB;"></a>&#x8BA1;&#x7B97;&#x8DDD;&#x79BB;</h4><p>&#x9996;&#x5148;&#xFF0C;&#x5148;&#x5B9A;&#x4E49;&#x4E00;&#x4E0B;&#x8DDD;&#x79BB;&#x5982;&#x4F55;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x7528;&#x5404;&#x79CD;&#x6570;&#x5B66;&#x4E0A;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x6B27;&#x5F0F;&#x8DDD;&#x79BB;&#x3001;&#x9A6C;&#x6C0F;&#x8DDD;&#x79BB;&#x7B49;&#x7B49;&#x3002;&#x3002;<br><br></p>
<p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x56FE;&#x7247;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#x4E86;&#x4E8C;&#x503C;&#x5316;&#xFF0C;&#x4E3A;&#x4E86;&#x7B80;&#x4FBF;&#x8D77;&#x89C1;&#xFF0C;&#x8FD9;&#x91CC;&#x628A;&#x4E24;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x8DDD;&#x79BB;&#x5B9A;&#x4E49;&#x4E3A;&#xFF1A;&#x4E24;&#x5F20;&#x56FE;&#x7247;&#x7070;&#x5EA6;&#x4E0D;&#x540C;&#x7684;&#x50CF;&#x7D20;&#x70B9;&#x4E2A;&#x6570;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x9010;&#x4E2A;&#x6BD4;&#x8F83;&#x56FE;&#x7247;&#x7684;&#x76F8;&#x5BF9;&#x4F4D;&#x7F6E;&#x4E0A;&#x7684;&#x7070;&#x5EA6;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x8DDD;&#x79BB;&#x5C31;&#x52A0;&#x4E00;&#x3002;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">count_distance</span><span class="params">(Mat mat1, Mat mat2)</span></span></div><div class="line">{</div><div class="line">    assert(mat1.size().height == mat2.size().height);</div><div class="line">    assert(mat1.size().width == mat2.size().width);</div><div class="line">    assert(mat1.channels() == <span class="number">1</span> &amp;&amp; mat2.channels() == <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> distance = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mat1.size().width; i++){</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mat1.size().height; j++){</div><div class="line">            <span class="keyword">if</span>(mat1.at&lt;uchar&gt;(j, i) != mat2.at&lt;uchar&gt;(j, i)){<span class="comment">//&#x4E0D;&#x76F8;&#x7B49;&#x5C31;&#x52A0;1</span></div><div class="line">                distance++;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> distance;</div><div class="line">}</div></pre></td></tr></table></figure></p>
<h4 id="&#x52A0;&#x8F7D;&#x6570;&#x636E;"><a href="#&#x52A0;&#x8F7D;&#x6570;&#x636E;" class="headerlink" title="&#x52A0;&#x8F7D;&#x6570;&#x636E;"></a>&#x52A0;&#x8F7D;&#x6570;&#x636E;</h4><p>&#x6570;&#x636E;&#x7684;&#x52A0;&#x8F7D;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x56FE;&#x7247;&#x6570;&#x7EC4;&#x548C;&#x4E00;&#x4E2A;&#x6807;&#x7B7E;&#x6570;&#x7EC4;&#xFF0C;&#x6765;&#x8BB0;&#x5F55;&#x56FE;&#x7247;&#x6570;&#x7EC4;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#x7684;&#x7C7B;&#x522B;&#x3002;<br><br>&#x52A0;&#x8F7D;&#x6837;&#x672C;&#x6570;&#x636E;&#xFF1A;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">load_dataset</span><span class="params">(Mat dataset[])</span></span></div><div class="line">{</div><div class="line">    <span class="built_in">string</span> dataset_dir = <span class="string">&quot;../recognizer/dataset/&quot;</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>*<span class="number">10</span>; i++){</div><div class="line">        <span class="keyword">char</span> buffer[<span class="number">255</span>];</div><div class="line">        <span class="built_in">sprintf</span>(buffer, <span class="string">&quot;%d&quot;</span>, i/<span class="number">6</span>);</div><div class="line">        <span class="built_in">string</span> image_path = dataset_dir + <span class="built_in">string</span>(buffer);</div><div class="line">        <span class="built_in">sprintf</span>(buffer, <span class="string">&quot;%d&quot;</span>, i%<span class="number">6</span> + <span class="number">1</span>);</div><div class="line">        image_path += <span class="built_in">string</span>(buffer) + <span class="string">&quot;.png&quot;</span>;</div><div class="line">        dataset[i] = imread(image_path, CV_LOAD_IMAGE_GRAYSCALE);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>&#x52A0;&#x8F7D;&#x6837;&#x672C;&#x6570;&#x636E;&#x6807;&#x7B7E;&#xFF1A;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">create_labels</span><span class="params">(<span class="keyword">int</span> labels[])</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>*<span class="number">10</span>; i++){</div><div class="line">        labels[i] = i/<span class="number">6</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure></p>
<h4 id="&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;"><a href="#&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;" class="headerlink" title="&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;"></a>&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;</h4><p>&#x52A0;&#x8F7D;&#x5B8C;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5B9E;&#x73B0;KNN&#x5206;&#x7C7B;&#x4E86;&#x3002;<br><br>1&#x3001;&#x8BA1;&#x7B97;&#x8F93;&#x5165;&#x56FE;&#x7247;&#x548C;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x56FE;&#x7247;&#x7684;&#x8DDD;&#x79BB;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> distances[<span class="number">6</span>*<span class="number">10</span>];</div><div class="line"><span class="keyword">int</span> sorted_distances[<span class="number">6</span>*<span class="number">10</span>];</div><div class="line"><span class="comment">//count distances</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>*<span class="number">10</span> ;i++){</div><div class="line">    distances[i] = count_distance(letter, dataset[i]);</div><div class="line">    sorted_distances[i] = distances[i];</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>2&#x3001;&#x5BF9;&#x8DDD;&#x79BB;&#x8FDB;&#x884C;&#x6392;&#x5E8F;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sort(sorted_distances, sorted_distances+<span class="number">6</span>*<span class="number">10</span>);</div></pre></td></tr></table></figure></p>
<p>3&#x3001;&#x83B7;&#x53D6;K&#x4E2A;&#x8DDD;&#x79BB;&#x6700;&#x8FD1;&#x7684;&#x56FE;&#x7247;&#x7684;&#x7C7B;&#x522B;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>* k_nearest = <span class="keyword">new</span> <span class="keyword">int</span>[k];</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++){</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">6</span>*<span class="number">10</span> ; j++){</div><div class="line">        <span class="keyword">if</span>(distances[j] == sorted_distances[i]){</div><div class="line">            k_nearest[i] = labels[j];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>4&#x3001;&#x5229;&#x7528;map&#x8BB0;&#x5F55;&#x6240;&#x6709;&#x7C7B;&#x522B;&#x4E2D;&#x51FA;&#x73B0;k_nearest&#x7684;&#x6B21;&#x6570;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; labels_map;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++){</div><div class="line">    <span class="keyword">if</span>(labels_map.find(k_nearest[i]) == labels_map.end())</div><div class="line">        labels_map[k_nearest[i]] = <span class="number">0</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        labels_map[k_nearest[i]]++;</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>5&#x3001;&#x5F97;&#x5230;&#x51FA;&#x73B0;&#x6700;&#x591A;&#x7684;&#x7C7B;&#x522B;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> max_label = <span class="number">-1</span>;</div><div class="line">labels_map[max_label] = <span class="number">-1</span>;</div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;::iterator it;</div><div class="line"><span class="keyword">for</span>(it=labels_map.begin();it!=labels_map.end();++it){</div><div class="line">    <span class="keyword">if</span>(it-&gt;second &gt; labels_map[max_label]){</div><div class="line">        max_label = it-&gt;first;</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">delete</span>[] k_nearest;</div><div class="line"><span class="keyword">return</span> max_label;</div></pre></td></tr></table></figure></p>
<h2 id="&#x8BC6;&#x522B;&#x9A8C;&#x8BC1;&#x7801;"><a href="#&#x8BC6;&#x522B;&#x9A8C;&#x8BC1;&#x7801;" class="headerlink" title="&#x8BC6;&#x522B;&#x9A8C;&#x8BC1;&#x7801;"></a>&#x8BC6;&#x522B;&#x9A8C;&#x8BC1;&#x7801;</h2><p>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x9A8C;&#x8BC1;&#x7801;&#x7684;4&#x4E2A;&#x5B57;&#x6BCD;&#x5206;&#x5272;&#x51FA;&#x6765;&#xFF0C;&#x518D;&#x8FDB;&#x884C;K&#x8FD1;&#x90BB;&#x5206;&#x7C7B;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x8BC6;&#x522B;&#x7ED3;&#x679C;&#x4E86;&#x3002;<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">recognize</span><span class="params">(<span class="built_in">string</span> path, Mat dataset[], <span class="keyword">int</span> labels[])</span></span></div><div class="line">{</div><div class="line">    Mat test_image = imread(path, CV_LOAD_IMAGE_GRAYSCALE);</div><div class="line">    threshold(test_image, test_image, <span class="number">100</span>, <span class="number">255</span>, cv::THRESH_BINARY);</div><div class="line">    Range col_ranges[<span class="number">4</span>] = {</div><div class="line">        Range(<span class="number">5</span>, <span class="number">5</span>+<span class="number">8</span>),</div><div class="line">        Range(<span class="number">14</span>, <span class="number">14</span>+<span class="number">8</span>),</div><div class="line">        Range(<span class="number">23</span>, <span class="number">23</span>+<span class="number">8</span>),</div><div class="line">        Range(<span class="number">32</span>, <span class="number">32</span>+<span class="number">8</span>)</div><div class="line">    };</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Result:&quot;</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++){</div><div class="line">        Mat letter = test_image.colRange(col_ranges[i]);</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; knn_classify(letter, dataset, labels, <span class="number">5</span>);</div><div class="line">    }</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">}</div></pre></td></tr></table></figure></p>
<h2 id="&#x6548;&#x679C;"><a href="#&#x6548;&#x679C;" class="headerlink" title="&#x6548;&#x679C;"></a>&#x6548;&#x679C;</h2><p>&#x8BC6;&#x522B;&#x56FE;&#x7247;&#xFF1A;<br><br><img src="/2016/09/22/&#x9A8C;&#x8BC1;&#x7801;&#x7834;&#x89E3;&#x6280;&#x672F;&#x56DB;&#x90E8;&#x66F2;&#x4E4B;&#x4F7F;&#x7528;K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;/captchas.png" alt="captchas"><br><br><br>&#x8BC6;&#x522B;&#x7ED3;&#x679C;&#xFF1A;<br><br><img src="/2016/09/22/&#x9A8C;&#x8BC1;&#x7801;&#x7834;&#x89E3;&#x6280;&#x672F;&#x56DB;&#x90E8;&#x66F2;&#x4E4B;&#x4F7F;&#x7528;K&#x8FD1;&#x90BB;&#x7B97;&#x6CD5;/captchas_result.png" alt="captchas_result"><br><br></p>
<h2 id="&#x7EC3;&#x4E60;"><a href="#&#x7EC3;&#x4E60;" class="headerlink" title="&#x7EC3;&#x4E60;"></a>&#x7EC3;&#x4E60;</h2><p>&#x901A;&#x8FC7;&#x4EE5;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x7834;&#x89E3;&#x4E86;CSDN&#x4E0B;&#x8F7D;&#x7684;&#x7B2C;&#x4E8C;&#x79CD;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C;&#x7B2C;&#x4E00;&#x79CD;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x8BC6;&#x522B;&#x8FC7;&#x7A0B;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;KNN&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x7B2C;&#x4E00;&#x79CD;&#x548C;&#x7B2C;&#x4E8C;&#x79CD;&#x7684;&#x5206;&#x5272;&#x5B57;&#x6BCD;&#x7684;&#x65B9;&#x5F0F;&#x4E0D;&#x540C;&#xFF0C;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;opencv&#x7684;findCountours&#x51FD;&#x6570;&#x5BF9;&#x5B57;&#x6BCD;&#x8FDB;&#x884C;&#x5206;&#x5272;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x5782;&#x76F4;&#x6295;&#x5F71;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x5206;&#x5272;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x7B2C;&#x4E00;&#x79CD;&#x9A8C;&#x8BC1;&#x7801;&#x6709;&#x4E00;&#x4E2A;&#x9ED1;&#x8272;&#x7684;&#x8FB9;&#x6846;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5904;&#x7406;&#x4F1A;&#x5F71;&#x54CD;findCountours&#x51FD;&#x6570;&#x7684;&#x6548;&#x679C;&#x3002;</p>
</div></article></div></main><footer><div class="paginator"><a href="../../23/验证码破解技术四部曲之使用卷积神经网络/" class="prev">PREV</a><a href="../../20/验证码破解技术四部曲之使用Tesseract/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2016/09/22/验证码破解技术四部曲之使用K近邻算法/';
var disqus_title = '验证码破解技术四部曲之使用K近邻算法（三）';
var disqus_url = 'http://nladuo.github.io/2016/09/22/验证码破解技术四部曲之使用K近邻算法/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://nladuo.github.io">叁公子</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>